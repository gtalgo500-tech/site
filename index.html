<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
<title>GTAlgo Portfolio Engine - Prop Firm Edition</title>
<style>
:root {
    --bg: #000000;
    --glass: rgba(255, 255, 255, 0.05);
    --glass-hover: rgba(255, 255, 255, 0.08);
    --border: rgba(255, 255, 255, 0.12);
    --text-primary: #f5f5f7;
    --text-secondary: #86868b;
    --accent: #0071e3;
    --accent-glow: rgba(0, 113, 227, 0.3);
    --green: #10b981;
    --yellow: #f59e0b;
    --red: #ef4444;
    --orange: #f97316;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body { 
    background: var(--bg); 
    color: var(--text-primary); 
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", sans-serif;
    line-height: 1.6;
    overflow-x: hidden;
}

body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: 
        linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
    background-size: 50px 50px;
    animation: gridMove 20s linear infinite;
    pointer-events: none;
    z-index: 0;
}

@keyframes gridMove {
    0% { transform: translate(0, 0); }
    100% { transform: translate(50px, 50px); }
}

.container{
    position:relative;
    z-index:1;
    max-width:1200px;
    margin:80px auto;
    padding:40px;
}

.header{
    text-align:center;
    margin-bottom:40px;
}

.logo{
    font-size:28px;
    font-weight:700;
    letter-spacing:1px;
}

.subtitle{
    color:var(--text-secondary);
    font-size:14px;
}

.lang-switcher {
    margin-top: 20px;
    display: flex;
    gap: 5px;
    background: var(--glass);
    padding: 4px;
    border-radius: 16px;
    border: 1px solid var(--border);
    justify-content: center;
}

.lang-btn {
    background: transparent;
    border: none;
    color: var(--text-secondary);
    padding: 6px 14px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    font-family: inherit;
}

.lang-btn:hover {
    color: var(--text-primary);
}

.lang-btn.active {
    background: var(--text-primary);
    color: #000;
    box-shadow: 0 2px 8px rgba(255, 255, 255, 0.2);
}

.glass{
    background:var(--glass);
    backdrop-filter: blur(40px);
    border:1px solid var(--border);
    border-radius:20px;
    padding:25px;
    box-shadow:0 0 40px rgba(0,113,227,0.08);
    margin-bottom:20px;
}

.grid{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:20px;
    margin-bottom:25px;
}

label{
    font-size:12px;
    color:var(--text-secondary);
    font-weight:500;
}

input,select{
    width:100%;
    margin-top:10px;
    padding:14px;
    border-radius:12px;
    background:rgba(0,0,0,0.6);
    border:1px solid var(--border);
    color:var(--text-primary);
    font-size:14px;
}

input:focus,select:focus{outline:none;border-color:var(--accent)}

.btn{
    width:100%;
    padding:16px;
    border-radius:14px;
    border:1px solid var(--border);
    background:linear-gradient(180deg, rgba(0,113,227,0.25), rgba(0,113,227,0.05));
    color:var(--text-primary);
    font-weight:600;
    cursor:pointer;
    box-shadow:0 0 25px var(--accent-glow);
    transition:all 0.2s;
}

.btn:hover{
    background:linear-gradient(180deg, rgba(0,113,227,0.35), rgba(0,113,227,0.1));
    transform:translateY(-1px);
}

.prop-toggle{
    display:flex;
    align-items:center;
    gap:12px;
    padding:18px;
    background:rgba(249,115,22,0.1);
    border:1px solid rgba(249,115,22,0.3);
    border-radius:14px;
    margin-bottom:20px;
}

.prop-toggle input[type="checkbox"]{
    width:22px;
    height:22px;
    margin:0;
    cursor:pointer;
}

.prop-toggle label{
    margin:0;
    font-size:14px;
    font-weight:600;
    color:var(--orange);
    cursor:pointer;
}

.prop-badge{
    background:rgba(249,115,22,0.2);
    color:var(--orange);
    padding:4px 10px;
    border-radius:6px;
    font-size:11px;
    font-weight:700;
    letter-spacing:0.5px;
}

.table-wrap{
    margin-top:30px;
    background:var(--glass);
    border:1px solid var(--border);
    border-radius:18px;
    overflow:hidden;
}

table{
    width:100%;
    border-collapse:collapse;
    font-size:13px;
}

th{
    background:rgba(0,0,0,0.6);
    color:var(--text-secondary);
    padding:14px;
    font-weight:600;
}

td{
    padding:12px;
    text-align:center;
    border-bottom:1px solid rgba(255,255,255,0.05);
}

tr:hover{background:var(--glass-hover)}

.ok{color:var(--green);font-weight:600}
.bad{color:var(--red);font-weight:600}
.warning{color:var(--orange);font-weight:600}

.info-box{
    padding:16px;
    border-radius:12px;
    margin-top:15px;
    font-size:13px;
    line-height:1.6;
}

.info-box.green{
    background:rgba(16,185,129,0.1);
    border:1px solid rgba(16,185,129,0.3);
    color:var(--green);
}

.info-box.red{
    background:rgba(239,68,68,0.1);
    border:1px solid rgba(239,68,68,0.3);
    color:var(--red);
}

.info-box.orange{
    background:rgba(249,115,22,0.1);
    border:1px solid rgba(249,115,22,0.3);
    color:var(--orange);
}

.stats-grid{
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:15px;
    margin-top:20px;
}

.stat-card{
    background:rgba(0,0,0,0.4);
    border:1px solid var(--border);
    border-radius:12px;
    padding:15px;
    text-align:center;
}

.stat-label{
    font-size:11px;
    color:var(--text-secondary);
    margin-bottom:6px;
}

.stat-value{
    font-size:20px;
    font-weight:700;
    color:var(--text-primary);
}

.footer{
    margin-top:20px;
    text-align:center;
    font-size:12px;
    color:var(--text-secondary);
}

@media (max-width: 768px) {
    .container {
        margin: 40px 15px;
        padding: 20px;
    }

    .grid {
        grid-template-columns: 1fr;
        gap: 20px;
    }

    .stats-grid{
        grid-template-columns: repeat(2,1fr);
    }

    .btn {
        padding: 16px;
        font-size: 14px;
    }

    input, select {
        padding: 12px;
        font-size: 14px;
    }

    table {
        font-size: 11px;
        display: block;
        overflow-x: auto;
    }
}   
</style>
</head>
<body>

<div class="container">

    <div class="header">
        <div class="logo">GTAlgo Portfolio Engine</div>
        <div class="subtitle translatable">Multi‚ÄëStrategy Automated Allocation System</div>
        <div class="lang-switcher">
            <button class="lang-btn active" data-lang="en">EN</button>
            <button class="lang-btn" data-lang="ro">RO</button>
        </div>
    </div>

    <div class="glass">
        <!-- PROP FIRM TOGGLE -->
        <div class="prop-toggle">
            <input type="checkbox" id="propFirmMode" onchange="updateRiskProfiles()">
            <label for="propFirmMode" class="translatable">üõ°Ô∏è PROP FIRM MODE (5% Daily Limit Protection)</label>
            <span class="prop-badge translatable">RECOMMENDED</span>
        </div>

        <div class="grid">
            <div>
                <label class="translatable">Account Balance ($)</label>
                <input type="number" id="balance" placeholder="e.g. 5000" value="10000">
            </div>

            <div>
                <label><span class="translatable">Risk Profile</span> <span id="riskLabel"></span></label>
                <select id="risk" onchange="updateLabel()">
                    <option value="0.5" class="translatable">Low Risk</option>
                    <option value="1" selected class="translatable">Normal Risk</option>
                    <option value="1.5" class="translatable">Aggressive</option>
                </select>
            </div>

            <div style="display:flex;align-items:flex-end">
                <button class="btn translatable" onclick="calc()">Calculate Portfolio Allocation</button>
            </div>
        </div>

        <div class="table-wrap" id="result"></div>
        <div id="statsBox"></div>
    </div>

    <div class="footer">
        <span class="translatable">‚ö†Ô∏è Prop Firm Mode reduces lot sizes by 3-5x to respect 5% daily loss limit when running multiple strategies simultaneously.</span><br>
        <span class="translatable">Historical performance does not guarantee future results.</span>
    </div>

</div>

<script>
const refBalance = 10000;

// TRANSLATION SYSTEM - MUST BE FIRST
const translations = {
  en: {
    'Multi‚ÄëStrategy Automated Allocation System': 'Multi‚ÄëStrategy Automated Allocation System',
    'üõ°Ô∏è PROP FIRM MODE (5% Daily Limit Protection)': 'üõ°Ô∏è PROP FIRM MODE (5% Daily Limit Protection)',
    'RECOMMENDED': 'RECOMMENDED',
    'Account Balance ($)': 'Account Balance ($)',
    'Risk Profile': 'Risk Profile',
    'Low Risk': 'Low Risk',
    'Normal Risk': 'Normal Risk',
    'Aggressive': 'Aggressive',
    'Calculate Portfolio Allocation': 'Calculate Portfolio Allocation',
    'Conservative (Prop Safe)': 'Conservative (Prop Safe)',
    'Balanced (Prop Safe)': 'Balanced (Prop Safe)',
    'Aggressive (Prop Safe)': 'Aggressive (Prop Safe)',
    'Strategy': 'Strategy',
    'Original Lot': 'Original Lot',
    'Calculated Lot': 'Calculated Lot',
    'Prop Firm Lot': 'Prop Firm Lot',
    'Status': 'Status',
    'Account too small:': 'Account too small:',
    'strategies below minimum lot size.': 'strategies below minimum lot size.',
    'Recommended minimum for Prop Firm Mode:': 'Recommended minimum for Prop Firm Mode:',
    'Recommended minimum:': 'Recommended minimum:',
    'Portfolio allocation valid': 'Portfolio allocation valid',
    'Lot sizes reduced by': 'Lot sizes reduced by',
    'for prop firm safety. All strategies can run simultaneously without hitting 5% daily limit.': 'for prop firm safety. All strategies can run simultaneously without hitting 5% daily limit.',
    'All strategies operational with standard risk parameters.': 'All strategies operational with standard risk parameters.',
    'Prop Firm Warning:': 'Prop Firm Warning:',
    'Running': 'Running',
    'strategies on': 'strategies on',
    'account increases risk.': 'account increases risk.',
    'Consider: (1) Increasing account size, (2) Running fewer strategies, or (3) Using Conservative profile.': 'Consider: (1) Increasing account size, (2) Running fewer strategies, or (3) Using Conservative profile.',
    'Active Strategies': 'Active Strategies',
    'Avg Lot Size': 'Avg Lot Size',
    'Risk Multiplier': 'Risk Multiplier',
    'Lot Reduction': 'Lot Reduction',
    'Mode': 'Mode',
    '‚ö†Ô∏è Prop Firm Mode reduces lot sizes by 3-5x to respect 5% daily loss limit when running multiple strategies simultaneously.': '‚ö†Ô∏è Prop Firm Mode reduces lot sizes by 3-5x to respect 5% daily loss limit when running multiple strategies simultaneously.',
    'Historical performance does not guarantee future results.': 'Historical performance does not guarantee future results.'
  },
  ro: {
    'Multi‚ÄëStrategy Automated Allocation System': 'Sistem Automat de Alocare Multi-Strategie',
    'üõ°Ô∏è PROP FIRM MODE (5% Daily Limit Protection)': 'üõ°Ô∏è MOD PROP FIRM (Protec»õie LimitƒÉ 5% Zilnic)',
    'RECOMMENDED': 'RECOMANDAT',
    'Account Balance ($)': 'Balan»õƒÉ Cont ($)',
    'Risk Profile': 'Profil Risc',
    'Low Risk': 'Risc Mic',
    'Normal Risk': 'Risc Normal',
    'Aggressive': 'Agresiv',
    'Calculate Portfolio Allocation': 'CalculeazƒÉ Alocarea Portofoliului',
    'Conservative (Prop Safe)': 'Conservator (Sigur Prop)',
    'Balanced (Prop Safe)': 'Echilibrat (Sigur Prop)',
    'Aggressive (Prop Safe)': 'Agresiv (Sigur Prop)',
    'Strategy': 'Strategie',
    'Original Lot': 'Lot Original',
    'Calculated Lot': 'Lot Calculat',
    'Prop Firm Lot': 'Lot Prop Firm',
    'Status': 'Status',
    'Account too small:': 'Cont prea mic:',
    'strategies below minimum lot size.': 'strategii sub lot-ul minim.',
    'Recommended minimum for Prop Firm Mode:': 'Minim recomandat pentru Modul Prop Firm:',
    'Recommended minimum:': 'Minim recomandat:',
    'Portfolio allocation valid': 'Alocare portofoliu validƒÉ',
    'Lot sizes reduced by': 'Lot-uri reduse cu',
    'for prop firm safety. All strategies can run simultaneously without hitting 5% daily limit.': 'pentru siguran»õa prop firm. Toate strategiile pot rula simultan fƒÉrƒÉ a atinge limita zilnicƒÉ de 5%.',
    'All strategies operational with standard risk parameters.': 'Toate strategiile opera»õionale cu parametri standard de risc.',
    'Prop Firm Warning:': 'Avertisment Prop Firm:',
    'Running': 'Rulare',
    'strategies on': 'strategii pe cont de',
    'account increases risk.': 'cre»ôte riscul.',
    'Consider: (1) Increasing account size, (2) Running fewer strategies, or (3) Using Conservative profile.': 'ConsiderƒÉ: (1) MƒÉrirea contului, (2) Rularea mai pu»õine strategii, sau (3) Folosirea profilului Conservator.',
    'Active Strategies': 'Strategii Active',
    'Avg Lot Size': 'Lot Mediu',
    'Risk Multiplier': 'Multiplicator Risc',
    'Lot Reduction': 'Reducere Lot',
    'Mode': 'Mod',
    '‚ö†Ô∏è Prop Firm Mode reduces lot sizes by 3-5x to respect 5% daily loss limit when running multiple strategies simultaneously.': '‚ö†Ô∏è Modul Prop Firm reduce lot-urile cu 3-5x pentru a respecta limita zilnicƒÉ de 5% c√¢nd rulezi multiple strategii simultan.',
    'Historical performance does not guarantee future results.': 'Performan»õa istoricƒÉ nu garanteazƒÉ rezultate viitoare.'
  }
};

let currentLang = localStorage.getItem('gtalgo-calc-lang') || 'en';
const originalTexts = new Map();

const portfolio = [
  {name:"GT-NovaPro US500", lot:5, min:0.1, group:"NovaPro"},
  {name:"GT-NovaPro US30", lot:0.5, min:0.1, group:"NovaPro"},

  {name:"GT-ApexPro XAU M15", lot:0.1, min:0.01, group:"ApexPro"},
  {name:"GT-ApexPro XAU H1", lot:0.13, min:0.01, group:"ApexPro"},
  {name:"GT-ApexPro USDJPY", lot:0.7, min:0.01, group:"ApexPro"},
  {name:"GT-ApexPro US100", lot:1.3, min:0.1, group:"ApexPro"},

  {name:"GT-StormX US30", lot:0.4, min:0.1, group:"StormX"},
  {name:"GT-StormX GER40", lot:1.3, min:0.1, group:"StormX"},
  {name:"GT-StormX US100", lot:1.3, min:0.1, group:"StormX"},

  {name:"GT-TitanX US500", lot:4, min:0.1, group:"TitanX"},

  {name:"GT-VectorPro XAU", lot:0.06, min:0.01, group:"VectorPro"},
  {name:"GT-VectorPro BTC", lot:0.1, min:0.01, group:"VectorPro"},
  {name:"GT-VectorPro NAS100", lot:1, min:0.1, group:"VectorPro"},
  {name:"GT-VectorPro USDJPY", lot:0.4, min:0.01, group:"VectorPro"}
];

function updateRiskProfiles(){
  const propMode = document.getElementById('propFirmMode').checked;
  const riskSelect = document.getElementById('risk');
  const lang = currentLang || 'en';
  
  if(propMode){
    riskSelect.innerHTML = `
      <option value="0.25" class="translatable">${translations[lang]['Conservative (Prop Safe)']}</option>
      <option value="0.33" selected class="translatable">${translations[lang]['Balanced (Prop Safe)']}</option>
      <option value="0.4" class="translatable">${translations[lang]['Aggressive (Prop Safe)']}</option>
    `;
  } else {
    riskSelect.innerHTML = `
      <option value="0.5" class="translatable">${translations[lang]['Low Risk']}</option>
      <option value="1" selected class="translatable">${translations[lang]['Normal Risk']}</option>
      <option value="1.5" class="translatable">${translations[lang]['Aggressive']}</option>
    `;
  }
  updateLabel();
}

function updateLabel(){
  const propMode = document.getElementById('propFirmMode').checked;
  const risk = parseFloat(document.getElementById('risk').value);
  const label = document.getElementById('riskLabel');
  
  if(propMode){
    const divider = (1 / risk).toFixed(1);
    label.textContent = `(${divider}x safer)`;
    label.style.color = 'var(--orange)';
  } else {
    label.textContent = '';
  }
}

function calc(){
  const balance = parseFloat(document.getElementById('balance').value);
  const risk = parseFloat(document.getElementById('risk').value);
  const propMode = document.getElementById('propFirmMode').checked;
  const lang = currentLang || 'en';
  
  if(!balance || balance<=0){
    alert('Enter valid balance');
    return;
  }

  // PROP FIRM: reduce lot size cu mult mai mult
  const propDivider = propMode ? 3.5 : 1; // 3.5x mai mic in prop firm mode
  const scale = (balance / refBalance) * risk / propDivider;

  let html = `<table>
    <tr>
      <th>${translations[lang]['Strategy']}</th>
      <th>${translations[lang]['Original Lot']}</th>
      <th>${propMode ? translations[lang]['Prop Firm Lot'] : translations[lang]['Calculated Lot']}</th>
      <th>${translations[lang]['Status']}</th>
    </tr>`;
  
  let valid = true;
  let totalOriginal = 0;
  let totalAdjusted = 0;
  let belowMin = 0;

  portfolio.forEach(p=>{
    let lot = p.lot * scale;
    let status = 'OK';
    let cls = 'ok';

    totalOriginal += p.lot;
    
    if(lot < p.min){
      status = 'BELOW MIN';
      cls = 'bad';
      valid = false;
      belowMin++;
    } else {
      totalAdjusted += lot;
    }

    html += `<tr>
      <td style="text-align:left">${p.name}</td>
      <td>${p.lot.toFixed(2)}</td>
      <td><strong>${lot.toFixed(3)}</strong></td>
      <td class="${cls}">${status}</td>
    </tr>`;
  });

  html += '</table>';

  // INFO BOXES
  let infoHtml = '';
  
  if(!valid){
    infoHtml += `<div class="info-box red">
      ‚ö†Ô∏è <strong>${translations[lang]['Account too small:']}</strong> ${belowMin} ${translations[lang]['strategies below minimum lot size.']}<br>
      ${propMode ? translations[lang]['Recommended minimum for Prop Firm Mode:'] + ' <strong>$15,000</strong>' : translations[lang]['Recommended minimum:'] + ' <strong>$5,000</strong>'}
    </div>`;
  } else {
    const reduction = ((1 - (scale / (balance / refBalance * risk))) * 100).toFixed(0);
    infoHtml += `<div class="info-box green">
      ‚úÖ <strong>${translations[lang]['Portfolio allocation valid']}</strong><br>
      ${propMode ? `${translations[lang]['Lot sizes reduced by']} ${reduction}% ${translations[lang]['for prop firm safety. All strategies can run simultaneously without hitting 5% daily limit.']}` : translations[lang]['All strategies operational with standard risk parameters.']}
    </div>`;
  }

  if(propMode && balance < 15000){
    infoHtml += `<div class="info-box orange">
      ‚ö° <strong>${translations[lang]['Prop Firm Warning:']}</strong> ${translations[lang]['Running']} ${portfolio.length} ${translations[lang]['strategies on']} $${balance.toLocaleString()} ${translations[lang]['account increases risk.']}<br>
      ${translations[lang]['Consider: (1) Increasing account size, (2) Running fewer strategies, or (3) Using Conservative profile.']}
    </div>`;
  }

  // STATS
  const avgLot = valid ? (totalAdjusted / portfolio.length).toFixed(3) : 0;
  const totalReduction = propMode ? ((totalOriginal - totalAdjusted) / totalOriginal * 100).toFixed(0) : 0;
  
  infoHtml += `<div class="stats-grid">
    <div class="stat-card">
      <div class="stat-label">${translations[lang]['Active Strategies']}</div>
      <div class="stat-value">${portfolio.length}</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">${translations[lang]['Avg Lot Size']}</div>
      <div class="stat-value">${avgLot}</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">${translations[lang]['Risk Multiplier']}</div>
      <div class="stat-value">${risk}x</div>
    </div>
    <div class="stat-card">
      <div class="stat-label">${propMode ? translations[lang]['Lot Reduction'] : translations[lang]['Mode']}</div>
      <div class="stat-value">${propMode ? totalReduction + '%' : 'Standard'}</div>
    </div>
  </div>`;

  document.getElementById('result').innerHTML = html;
  document.getElementById('statsBox').innerHTML = infoHtml;
}

// Store original texts on page load
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.translatable').forEach(function(el) {
    originalTexts.set(el, el.textContent.trim());
  });
  
  // Initialize language
  setLanguage(currentLang);
  
  // Initialize risk profiles
  updateRiskProfiles();
  updateLabel();
});

function setLanguage(lang) {
  currentLang = lang;
  localStorage.setItem('gtalgo-calc-lang', lang);

  // Translate all elements
  document.querySelectorAll('.translatable').forEach(function(el) {
    const originalKey = originalTexts.get(el);
    if (originalKey && translations[lang][originalKey]) {
      el.textContent = translations[lang][originalKey];
    }
  });

  // Update button states
  document.querySelectorAll('.lang-btn').forEach(function(btn) {
    btn.classList.remove('active');
    if (btn.getAttribute('data-lang') === lang) {
      btn.classList.add('active');
    }
  });

  // Re-run updateRiskProfiles to translate dropdown
  updateRiskProfiles();
}

// Add event listeners to language buttons
document.querySelectorAll('.lang-btn').forEach(function(btn) {
  btn.addEventListener('click', function() {
    const lang = btn.getAttribute('data-lang');
    setLanguage(lang);
  });
});
</script>
</body>
</html>
