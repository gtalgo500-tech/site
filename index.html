<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
<title>GTAlgo Portfolio Engine</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #000000;
  --surface: #0a0a0a;
  --surface2: #111111;
  --border: rgba(48,54,66,0.8);
  --border-bright: rgba(99,110,130,0.4);
  --text: #e6edf3;
  --muted: #7d8590;
  --accent: #58a6ff;
  --accent-dim: rgba(88,166,255,0.12);
  --accent-glow: rgba(88,166,255,0.25);
  --green: #3fb950;
  --green-dim: rgba(63,185,80,0.12);
  --red: #f85149;
  --red-dim: rgba(248,81,73,0.1);
  --orange: #d29922;
  --orange-dim: rgba(210,153,34,0.1);
  --purple: #bc8cff;
  --purple-dim: rgba(188,140,255,0.1);
  --mono: 'Space Mono', monospace;
  --sans: 'Outfit', sans-serif;
}

* { margin:0; padding:0; box-sizing:border-box; }

html { scroll-behavior: smooth; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--sans);
  min-height: 100vh;
  overflow-x: hidden;
}

/* â”€â”€ BACKGROUND â”€â”€ */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background: #000000;
  pointer-events: none;
  z-index: 0;
}

/* animated grid */
body::after {
  content: '';
  position: fixed;
  inset: 0;
  background-image:
    linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
  background-size: 50px 50px;
  animation: gridMove 20s linear infinite;
  pointer-events: none;
  z-index: 0;
}

@keyframes gridMove {
  0% { transform: translate(0, 0); }
  100% { transform: translate(50px, 50px); }
}

.wrap {
  position: relative;
  z-index: 1;
  max-width: 1100px;
  margin: 0 auto;
  padding: 50px 24px 80px;
}

/* â”€â”€ HEADER â”€â”€ */
.header {
  margin-bottom: 48px;
}

.header-top {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 20px;
  margin-bottom: 18px;
}

.brand {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.brand-logo {
  font-family: var(--mono);
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 3px;
  color: var(--accent);
  text-transform: uppercase;
  display: flex;
  align-items: center;
  gap: 8px;
}

.brand-logo::before {
  content: '';
  display: inline-block;
  width: 6px;
  height: 6px;
  background: var(--accent);
  border-radius: 50%;
  box-shadow: 0 0 8px var(--accent);
  animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.5; transform: scale(0.8); }
}

.brand-title {
  font-size: 32px;
  font-weight: 800;
  letter-spacing: -1px;
  color: var(--text);
  line-height: 1;
}

.brand-sub {
  font-size: 13px;
  color: var(--muted);
  font-weight: 400;
  letter-spacing: 0.3px;
}

.header-right {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 10px;
}

.lang-switcher {
  display: flex;
  gap: 2px;
  background: var(--surface2);
  padding: 3px;
  border-radius: 8px;
  border: 1px solid var(--border);
}

.lang-btn {
  background: transparent;
  border: none;
  color: var(--muted);
  padding: 5px 12px;
  border-radius: 6px;
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 1px;
  cursor: pointer;
  transition: all 0.2s;
  font-family: var(--mono);
}

.lang-btn:hover { color: var(--text); }

.lang-btn.active {
  background: var(--accent);
  color: #000;
}

.version-tag {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--muted);
  letter-spacing: 1px;
}

/* â”€â”€ DIVIDER â”€â”€ */
.header-divider {
  height: 1px;
  background: linear-gradient(90deg, var(--accent), rgba(88,166,255,0.1), transparent);
  margin-top: 10px;
}

/* â”€â”€ CARD â”€â”€ */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 24px;
  margin-bottom: 16px;
  transition: border-color 0.2s;
}

.card:hover { border-color: var(--border-bright); }

.card-label {
  font-family: var(--mono);
  font-size: 10px;
  letter-spacing: 2px;
  color: var(--muted);
  text-transform: uppercase;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.card-label::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--border);
}

/* â”€â”€ PROP TOGGLE â”€â”€ */
.prop-toggle {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 16px 20px;
  background: rgba(210,153,34,0.07);
  border: 1px solid rgba(210,153,34,0.25);
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.2s;
  margin-bottom: 20px;
}

.prop-toggle:hover {
  background: rgba(210,153,34,0.12);
  border-color: rgba(210,153,34,0.4);
}

.toggle-switch {
  position: relative;
  width: 40px;
  height: 22px;
  flex-shrink: 0;
}

.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
  position: absolute;
}

.toggle-track {
  position: absolute;
  inset: 0;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 11px;
  transition: all 0.3s;
  cursor: pointer;
}

.toggle-track::after {
  content: '';
  position: absolute;
  top: 3px;
  left: 3px;
  width: 14px;
  height: 14px;
  background: var(--muted);
  border-radius: 50%;
  transition: all 0.3s;
}

.toggle-switch input:checked + .toggle-track {
  background: rgba(210,153,34,0.25);
  border-color: var(--orange);
}

.toggle-switch input:checked + .toggle-track::after {
  transform: translateX(18px);
  background: var(--orange);
  box-shadow: 0 0 8px rgba(210,153,34,0.5);
}

.toggle-info {
  flex: 1;
}

.toggle-title {
  font-size: 13px;
  font-weight: 600;
  color: var(--orange);
  margin-bottom: 2px;
}

.toggle-desc {
  font-size: 11px;
  color: var(--muted);
}

.prop-badge {
  background: rgba(210,153,34,0.15);
  border: 1px solid rgba(210,153,34,0.3);
  color: var(--orange);
  padding: 3px 8px;
  border-radius: 4px;
  font-family: var(--mono);
  font-size: 9px;
  font-weight: 700;
  letter-spacing: 1px;
  white-space: nowrap;
}

/* â”€â”€ CONTROLS â”€â”€ */
.controls {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 16px;
  align-items: end;
}

.field label {
  display: block;
  font-size: 11px;
  font-weight: 600;
  color: var(--muted);
  letter-spacing: 0.5px;
  margin-bottom: 8px;
  text-transform: uppercase;
  font-family: var(--mono);
}

.field input,
.field select {
  width: 100%;
  padding: 12px 14px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text);
  font-size: 14px;
  font-family: var(--sans);
  transition: all 0.2s;
  appearance: none;
}

.field input:focus,
.field select:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-dim);
}

.field select {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%237d8590' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  padding-right: 32px;
  cursor: pointer;
}

.calc-btn {
  width: 100%;
  padding: 13px 20px;
  background: linear-gradient(135deg, rgba(88,166,255,0.2), rgba(88,166,255,0.08));
  border: 1px solid rgba(88,166,255,0.35);
  border-radius: 8px;
  color: var(--accent);
  font-size: 13px;
  font-weight: 700;
  font-family: var(--mono);
  letter-spacing: 1px;
  cursor: pointer;
  transition: all 0.2s;
  text-transform: uppercase;
  position: relative;
  overflow: hidden;
}

.calc-btn::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(88,166,255,0.15), transparent);
  opacity: 0;
  transition: opacity 0.2s;
}

.calc-btn:hover {
  border-color: var(--accent);
  box-shadow: 0 0 20px var(--accent-glow);
  transform: translateY(-1px);
}

.calc-btn:hover::before { opacity: 1; }

.calc-btn:active { transform: translateY(0); }

/* â”€â”€ STATS ROW â”€â”€ */
.stats-row {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 12px;
  margin-bottom: 16px;
}

.stat {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 14px;
  text-align: center;
  transition: all 0.2s;
}

.stat:hover {
  border-color: var(--border-bright);
  transform: translateY(-1px);
}

.stat-num {
  font-family: var(--mono);
  font-size: 22px;
  font-weight: 700;
  color: var(--text);
  line-height: 1;
  margin-bottom: 4px;
}

.stat-lbl {
  font-size: 10px;
  color: var(--muted);
  letter-spacing: 0.5px;
  text-transform: uppercase;
}

/* â”€â”€ TABLE â”€â”€ */
.table-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  overflow: hidden;
  margin-bottom: 16px;
}

.table-header {
  padding: 16px 20px;
  background: var(--surface2);
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.table-title {
  font-family: var(--mono);
  font-size: 11px;
  letter-spacing: 2px;
  color: var(--muted);
  text-transform: uppercase;
}

.table-meta {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--muted);
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
}

th {
  background: rgba(0,0,0,0.3);
  color: var(--muted);
  padding: 10px 16px;
  font-weight: 600;
  font-family: var(--mono);
  font-size: 10px;
  letter-spacing: 1px;
  text-transform: uppercase;
  white-space: nowrap;
}

th:first-child { text-align: left; }

td {
  padding: 11px 16px;
  text-align: center;
  border-bottom: 1px solid rgba(48,54,66,0.5);
  transition: background 0.15s;
}

td:first-child { text-align: left; }

tr:last-child td { border-bottom: none; }
tr:hover td { background: rgba(255,255,255,0.02); }

.group-row td {
  background: rgba(88,166,255,0.05);
  border-top: 1px solid rgba(88,166,255,0.15);
  border-bottom: 1px solid rgba(88,166,255,0.08);
  padding: 7px 16px;
  text-align: left;
}

.group-row:first-child td { border-top: none; }

.group-name {
  font-family: var(--mono);
  font-size: 10px;
  letter-spacing: 2px;
  color: var(--accent);
  font-weight: 700;
  text-transform: uppercase;
  display: flex;
  align-items: center;
  gap: 8px;
}

.group-dot {
  width: 5px;
  height: 5px;
  background: var(--accent);
  border-radius: 50%;
  box-shadow: 0 0 6px var(--accent);
}

.strategy-name {
  font-weight: 500;
  color: var(--text);
  padding-left: 8px;
}

.lot-value {
  font-family: var(--mono);
  font-weight: 700;
  font-size: 14px;
}

.tag {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 3px 8px;
  border-radius: 4px;
  font-family: var(--mono);
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 0.5px;
}

.tag-ok {
  background: var(--green-dim);
  border: 1px solid rgba(63,185,80,0.25);
  color: var(--green);
}

.tag-bad {
  background: var(--red-dim);
  border: 1px solid rgba(248,81,73,0.25);
  color: var(--red);
}

.tag-warn {
  background: var(--orange-dim);
  border: 1px solid rgba(210,153,34,0.25);
  color: var(--orange);
}

/* â”€â”€ INFO BOXES â”€â”€ */
.infobox {
  padding: 14px 18px;
  border-radius: 10px;
  font-size: 13px;
  line-height: 1.6;
  margin-bottom: 12px;
  display: flex;
  gap: 12px;
  align-items: flex-start;
}

.infobox-icon {
  font-size: 16px;
  flex-shrink: 0;
  margin-top: 1px;
}

.infobox.green {
  background: var(--green-dim);
  border: 1px solid rgba(63,185,80,0.25);
  color: var(--green);
}

.infobox.red {
  background: var(--red-dim);
  border: 1px solid rgba(248,81,73,0.25);
  color: var(--red);
}

.infobox.orange {
  background: var(--orange-dim);
  border: 1px solid rgba(210,153,34,0.25);
  color: var(--orange);
}

.infobox.purple {
  background: var(--purple-dim);
  border: 1px solid rgba(188,140,255,0.2);
  color: var(--purple);
}

.infobox strong { font-weight: 700; }

/* â”€â”€ FOOTER â”€â”€ */
.footer {
  margin-top: 32px;
  padding-top: 20px;
  border-top: 1px solid var(--border);
  text-align: center;
}

.footer p {
  font-size: 11px;
  color: var(--muted);
  line-height: 1.8;
}

/* â”€â”€ ANIMATIONS â”€â”€ */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

.animate-in {
  animation: fadeIn 0.35s ease forwards;
}

.animate-in-delay {
  opacity: 0;
  animation: fadeIn 0.35s ease 0.1s forwards;
}

/* â”€â”€ EMPTY STATE â”€â”€ */
.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: var(--muted);
}

.empty-state-icon {
  font-size: 40px;
  margin-bottom: 16px;
  opacity: 0.4;
}

.empty-state-text {
  font-size: 13px;
  letter-spacing: 0.5px;
}

/* â”€â”€ RESPONSIVE â”€â”€ */
@media (max-width: 768px) {
  .wrap { padding: 30px 16px 60px; }
  .header-top { flex-direction: column; }
  .header-right { align-items: flex-start; }
  .controls { grid-template-columns: 1fr; }
  .stats-row { grid-template-columns: repeat(3, 1fr); }
  .stats-row .stat:nth-child(4),
  .stats-row .stat:nth-child(5) { grid-column: span 1; }
  table { font-size: 11px; }
  th, td { padding: 9px 10px; }
  .brand-title { font-size: 24px; }
}

@media (max-width: 480px) {
  .stats-row { grid-template-columns: repeat(2, 1fr); }
  table { display: block; overflow-x: auto; }
}
</style>
</head>
<body>

<div class="wrap">

  <!-- HEADER -->
  <div class="header">
    <div class="header-top">
      <div class="brand">
        <div class="brand-logo">GTAlgo Systems</div>
        <div class="brand-title">Portfolio Engine</div>
        <div class="brand-sub translatable">Multi-Strategy Automated Allocation System</div>
      </div>
      <div class="header-right">
        <div class="lang-switcher">
          <button class="lang-btn active" data-lang="en">EN</button>
          <button class="lang-btn" data-lang="ro">RO</button>
        </div>
        <div class="version-tag">v3.0 Â· MC CALIBRATED</div>
      </div>
    </div>
    <div class="header-divider"></div>
  </div>

  <!-- MAIN CARD -->
  <div class="card">
    <div class="card-label translatable">Configuration</div>

    <!-- PROP TOGGLE -->
    <div class="prop-toggle" onclick="document.getElementById('propFirmMode').click()">
      <label class="toggle-switch" onclick="event.stopPropagation()">
        <input type="checkbox" id="propFirmMode" onchange="updateRiskProfiles()">
        <div class="toggle-track"></div>
      </label>
      <div class="toggle-info">
        <div class="toggle-title translatable">ğŸ›¡ï¸ PROP FIRM MODE â€” 5% Daily Limit Protection</div>
        <div class="toggle-desc translatable">Reduces lot sizes proportionally to run all strategies simultaneously</div>
      </div>
      <div class="prop-badge translatable">RECOMMENDED</div>
    </div>

    <!-- CONTROLS -->
    <div class="controls">
      <div class="field">
        <label class="translatable">Account Balance ($)</label>
        <input type="number" id="balance" placeholder="e.g. 10000" value="10000" min="0">
      </div>
      <div class="field">
        <label><span class="translatable">Risk Profile</span> <span id="riskLabel" style="color:var(--orange);font-size:10px;"></span></label>
        <select id="risk" onchange="updateLabel()"></select>
      </div>
      <div class="field">
        <label style="visibility:hidden">action</label>
        <button class="calc-btn translatable" onclick="calc()">â–¶ Calculate Allocation</button>
      </div>
    </div>
  </div>

  <!-- RESULTS -->
  <div id="results"></div>

  <!-- FOOTER -->
  <div class="footer">
    <p>
      <span class="translatable">âš ï¸ Lots calibrated against Monte Carlo 25â€“30% drawdown reality. Prop Firm Mode adds additional safety divider for simultaneous multi-strategy execution.</span><br>
      <span class="translatable">Historical performance does not guarantee future results. Trade responsibly.</span>
    </p>
  </div>

</div>

<script>
// â”€â”€â”€ TRANSLATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const T = {
  en: {
    'Multi-Strategy Automated Allocation System': 'Multi-Strategy Automated Allocation System',
    'Configuration': 'Configuration',
    'ğŸ›¡ï¸ PROP FIRM MODE â€” 5% Daily Limit Protection': 'ğŸ›¡ï¸ PROP FIRM MODE â€” 5% Daily Limit Protection',
    'Reduces lot sizes proportionally to run all strategies simultaneously': 'Reduces lot sizes proportionally to run all strategies simultaneously',
    'RECOMMENDED': 'RECOMMENDED',
    'Account Balance ($)': 'Account Balance ($)',
    'Risk Profile': 'Risk Profile',
    'â–¶ Calculate Allocation': 'â–¶ Calculate Allocation',
    'Conservative': 'Conservative',
    'Balanced': 'Balanced',
    'Aggressive': 'Aggressive',
    'Prop Safe â€” Conservative': 'Prop Safe â€” Conservative',
    'Prop Safe â€” Balanced': 'Prop Safe â€” Balanced',
    'Prop Safe â€” Aggressive': 'Prop Safe â€” Aggressive',
    'Strategy': 'Strategy',
    'Lot Size': 'Lot Size',
    'Status': 'Status',
    'Active Strategies': 'Active Strategies',
    'Avg Lot': 'Avg Lot',
    'Risk Mult.': 'Risk Mult.',
    'Prop Reduction': 'Prop Reduction',
    'Mode': 'Mode',
    'Standard': 'Standard',
    'Allocation Table': 'Allocation Table',
    'âœ… Portfolio allocation valid': 'âœ… Portfolio allocation valid',
    'All strategies operational. MC-calibrated lots protect against real 25â€“30% drawdown scenarios.': 'All strategies operational. MC-calibrated lots protect against real 25â€“30% drawdown scenarios.',
    'Prop Firm Mode active': 'Prop Firm Mode active',
    'Prop Firm Mode active â€” lot sizes further reduced by': 'Prop Firm Mode active â€” lot sizes further reduced by',
    'All strategies can run simultaneously within the 5% daily loss limit.': 'All strategies can run simultaneously within the 5% daily loss limit.',
    'âš ï¸ Account too small:': 'âš ï¸ Account too small:',
    'strategies are below the minimum lot threshold.': 'strategies are below the minimum lot threshold.',
    'Recommended minimum (Prop Firm):': 'Recommended minimum (Prop Firm):',
    'Recommended minimum:': 'Recommended minimum:',
    'âš¡ Prop Firm Warning:': 'âš¡ Prop Firm Warning:',
    'Running': 'Running',
    'strategies on a': 'strategies on a',
    'account concentrates risk. Consider increasing balance, reducing active strategies, or switching to Conservative profile.': 'account concentrates risk. Consider increasing balance, reducing active strategies, or switching to Conservative profile.',
    'âš ï¸ Lots calibrated against Monte Carlo 25â€“30% drawdown reality. Prop Firm Mode adds additional safety divider for simultaneous multi-strategy execution.': 'âš ï¸ Lots calibrated against Monte Carlo 25â€“30% drawdown reality. Prop Firm Mode adds additional safety divider for simultaneous multi-strategy execution.',
    'Historical performance does not guarantee future results. Trade responsibly.': 'Historical performance does not guarantee future results. Trade responsibly.',
    'Account': 'Account',
    'MC-calibrated': 'MC-calibrated',
    'BELOW MIN': 'BELOW MIN',
    'OK': 'OK',
  },
  ro: {
    'Multi-Strategy Automated Allocation System': 'Sistem Automat de Alocare Multi-Strategie',
    'Configuration': 'Configurare',
    'ğŸ›¡ï¸ PROP FIRM MODE â€” 5% Daily Limit Protection': 'ğŸ›¡ï¸ MOD PROP FIRM â€” ProtecÈ›ie LimitÄƒ 5% Zilnic',
    'Reduces lot sizes proportionally to run all strategies simultaneously': 'Reduce lot-urile proporÈ›ional pentru a rula toate strategiile simultan',
    'RECOMMENDED': 'RECOMANDAT',
    'Account Balance ($)': 'BalanÈ›Äƒ Cont ($)',
    'Risk Profile': 'Profil Risc',
    'â–¶ Calculate Allocation': 'â–¶ CalculeazÄƒ Alocarea',
    'Conservative': 'Conservator',
    'Balanced': 'Echilibrat',
    'Aggressive': 'Agresiv',
    'Prop Safe â€” Conservative': 'Prop Safe â€” Conservator',
    'Prop Safe â€” Balanced': 'Prop Safe â€” Echilibrat',
    'Prop Safe â€” Aggressive': 'Prop Safe â€” Agresiv',
    'Strategy': 'Strategie',
    'Lot Size': 'MÄƒrime Lot',
    'Status': 'Status',
    'Active Strategies': 'Strategii Active',
    'Avg Lot': 'Lot Mediu',
    'Risk Mult.': 'Mult. Risc',
    'Prop Reduction': 'Reducere Prop',
    'Mode': 'Mod',
    'Standard': 'Standard',
    'Allocation Table': 'Tabel Alocare',
    'âœ… Portfolio allocation valid': 'âœ… Alocare portofoliu validÄƒ',
    'All strategies operational. MC-calibrated lots protect against real 25â€“30% drawdown scenarios.': 'Toate strategiile operaÈ›ionale. Lot-urile calibrate MC protejeazÄƒ Ã®mpotriva drawdown-ului real de 25â€“30%.',
    'Prop Firm Mode active': 'Modul Prop Firm activ',
    'Prop Firm Mode active â€” lot sizes further reduced by': 'Modul Prop Firm activ â€” lot-uri reduse suplimentar cu',
    'All strategies can run simultaneously within the 5% daily loss limit.': 'Toate strategiile pot rula simultan Ã®n limita zilnicÄƒ de 5%.',
    'âš ï¸ Account too small:': 'âš ï¸ Cont prea mic:',
    'strategies are below the minimum lot threshold.': 'strategii sunt sub pragul minim de lot.',
    'Recommended minimum (Prop Firm):': 'Minim recomandat (Prop Firm):',
    'Recommended minimum:': 'Minim recomandat:',
    'âš¡ Prop Firm Warning:': 'âš¡ Avertisment Prop Firm:',
    'Running': 'Rulare',
    'strategies on a': 'strategii pe cont de',
    'account concentrates risk. Consider increasing balance, reducing active strategies, or switching to Conservative profile.': 'concentreazÄƒ riscul. ConsiderÄƒ mÄƒrirea contului, reducerea strategiilor active sau profilul Conservator.',
    'âš ï¸ Lots calibrated against Monte Carlo 25â€“30% drawdown reality. Prop Firm Mode adds additional safety divider for simultaneous multi-strategy execution.': 'âš ï¸ Lot-urile sunt calibrate faÈ›Äƒ de realitatea Monte Carlo de 25â€“30% drawdown. Modul Prop Firm adaugÄƒ un divider de siguranÈ›Äƒ suplimentar pentru execuÈ›ia simultanÄƒ a mai multor strategii.',
    'Historical performance does not guarantee future results. Trade responsibly.': 'PerformanÈ›a istoricÄƒ nu garanteazÄƒ rezultate viitoare. TranzacÈ›ioneazÄƒ responsabil.',
    'Account': 'Cont',
    'MC-calibrated': 'Calibrat MC',
    'BELOW MIN': 'SUB MINIM',
    'OK': 'OK',
  }
};

let lang = localStorage.getItem('gtalgo-lang') || 'en';
const origTexts = new Map();

function t(key) { return T[lang][key] || key; }

// â”€â”€â”€ PORTFOLIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Base lots represent 10% DD in backtest.
// Monte Carlo reality factor applied: 10% / 27.5% â‰ˆ 0.3636
// This corrects lots to match real-world 25-30% DD performance.
// The MC correction is baked into the calculated base â€” no separate toggle needed.
const MC_FACTOR = 10 / 27.5; // â‰ˆ 0.3636

const refBalance = 10000;

const portfolio = [
  // â”€â”€â”€ NovaPro â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { name: 'GT-NovaPro US500',      btLot: 5,    min: 0.1,  dec: 1, group: 'NovaPro' },
  { name: 'GT-NovaPro US30',       btLot: 0.5,  min: 0.1,  dec: 1, group: 'NovaPro' },

  // â”€â”€â”€ ApexPro â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { name: 'GT-ApexPro XAU M15',    btLot: 0.1,  min: 0.01, dec: 2, group: 'ApexPro' },
  { name: 'GT-ApexPro XAU H1',     btLot: 0.13, min: 0.01, dec: 2, group: 'ApexPro' },
  { name: 'GT-ApexPro USDJPY',     btLot: 0.7,  min: 0.01, dec: 2, group: 'ApexPro' },
  { name: 'GT-ApexPro US100',      btLot: 1.3,  min: 0.1,  dec: 1, group: 'ApexPro' },

  // â”€â”€â”€ ApexProSO (NEW) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { name: 'GT-ApexProSO BTC 15M',  btLot: 0.15, min: 0.01, dec: 2, group: 'ApexProSO' },
  { name: 'GT-ApexProSO NAS M6',   btLot: 1.5,  min: 0.1,  dec: 1, group: 'ApexProSO' },
  { name: 'GT-ApexProSO US500 M15',btLot: 6,    min: 0.1,  dec: 1, group: 'ApexProSO' },
  { name: 'GT-ApexProSO XAU M15',  btLot: 0.1,  min: 0.01, dec: 2, group: 'ApexProSO' },

  // â”€â”€â”€ StormX â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { name: 'GT-StormX US30',        btLot: 0.4,  min: 0.1,  dec: 1, group: 'StormX' },
  { name: 'GT-StormX GER40',       btLot: 1.3,  min: 0.1,  dec: 1, group: 'StormX' },
  { name: 'GT-StormX US100',       btLot: 1.3,  min: 0.1,  dec: 1, group: 'StormX' },

  // â”€â”€â”€ TitanX â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { name: 'GT-TitanX US500',       btLot: 4,    min: 0.1,  dec: 1, group: 'TitanX' },

  // â”€â”€â”€ VectorPro â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  { name: 'GT-VectorPro XAU',      btLot: 0.06, min: 0.01, dec: 2, group: 'VectorPro' },
  { name: 'GT-VectorPro BTC',      btLot: 0.1,  min: 0.01, dec: 2, group: 'VectorPro' },
  { name: 'GT-VectorPro NAS100',   btLot: 1,    min: 0.1,  dec: 1, group: 'VectorPro' },
  { name: 'GT-VectorPro USDJPY',   btLot: 0.4,  min: 0.01, dec: 2, group: 'VectorPro' }
];

// Floor to allowed decimal places (never exceed risk)
function floorLot(val, dec) {
  const f = Math.pow(10, dec);
  return (Math.floor(val * f) / f).toFixed(dec);
}

// â”€â”€â”€ RISK PROFILES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateRiskProfiles() {
  const prop = document.getElementById('propFirmMode').checked;
  const sel = document.getElementById('risk');
  sel.innerHTML = prop
    ? `<option value="0.25">${t('Prop Safe â€” Conservative')}</option>
       <option value="0.33" selected>${t('Prop Safe â€” Balanced')}</option>
       <option value="0.4">${t('Prop Safe â€” Aggressive')}</option>`
    : `<option value="0.5">${t('Conservative')}</option>
       <option value="1" selected>${t('Balanced')}</option>
       <option value="1.5">${t('Aggressive')}</option>`;
  updateLabel();
}

function updateLabel() {
  const prop = document.getElementById('propFirmMode').checked;
  const risk = parseFloat(document.getElementById('risk').value);
  const lbl = document.getElementById('riskLabel');
  lbl.textContent = prop ? `(Ã·${(1/risk).toFixed(1)}x)` : '';
}

// â”€â”€â”€ MAIN CALC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function calc() {
  const balance = parseFloat(document.getElementById('balance').value);
  const risk = parseFloat(document.getElementById('risk').value);
  const prop = document.getElementById('propFirmMode').checked;

  if (!balance || balance <= 0) { alert('Enter a valid account balance.'); return; }

  // MC calibration already accounts for real-world drawdown.
  // Prop Firm Mode uses conservative risk profiles only â€” no additional lot divider needed.
  const scale = (balance / refBalance) * risk * MC_FACTOR;

  // â”€â”€ Build table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let rows = '';
  let lastGroup = null;
  let belowMin = 0;
  let totalLots = 0;
  let validCount = 0;

  const groupColors = {
    NovaPro: '#58a6ff',
    ApexPro: '#3fb950',
    ApexProSO: '#bc8cff',
    StormX: '#f78166',
    TitanX: '#d29922',
    VectorPro: '#79c0ff'
  };

  portfolio.forEach(p => {
    const rawLot = p.btLot * scale;
    const lotStr = floorLot(rawLot, p.dec);
    const lotNum = parseFloat(lotStr);
    const below = lotNum < p.min;
    if (below) belowMin++;
    else { totalLots += lotNum; validCount++; }

    if (p.group !== lastGroup) {
      const color = groupColors[p.group] || 'var(--accent)';
      rows += `<tr class="group-row">
        <td colspan="3">
          <div class="group-name">
            <span class="group-dot" style="background:${color};box-shadow:0 0 6px ${color}"></span>
            ${p.group}
          </div>
        </td>
      </tr>`;
      lastGroup = p.group;
    }

    rows += `<tr>
      <td><span class="strategy-name">${p.name}</span></td>
      <td><span class="lot-value" style="color:${below ? 'var(--red)' : 'var(--text)'}">${lotStr}</span></td>
      <td>
        <span class="tag ${below ? 'tag-bad' : 'tag-ok'}">
          ${below ? t('BELOW MIN') : t('OK')}
        </span>
      </td>
    </tr>`;
  });

  const avgLot = validCount > 0 ? (totalLots / validCount).toFixed(2) : '0.00';
  const propReduction = 0; // No additional lot reduction in Prop Mode â€” MC calibration sufficient
  const allValid = belowMin === 0;

  // â”€â”€ Stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const statsHtml = `
  <div class="stats-row animate-in">
    <div class="stat">
      <div class="stat-num">${portfolio.length}</div>
      <div class="stat-lbl">${t('Active Strategies')}</div>
    </div>
    <div class="stat">
      <div class="stat-num" style="font-size:16px">$${balance.toLocaleString()}</div>
      <div class="stat-lbl">${t('Account')}</div>
    </div>
    <div class="stat">
      <div class="stat-num">${risk}x</div>
      <div class="stat-lbl">${t('Risk Mult.')}</div>
    </div>
    <div class="stat">
      <div class="stat-num">${avgLot}</div>
      <div class="stat-lbl">${t('Avg Lot')}</div>
    </div>
    <div class="stat">
      <div class="stat-num" style="color:${prop ? 'var(--orange)' : 'var(--muted)'}">
        ${prop ? propReduction + '%' : t('Standard')}
      </div>
      <div class="stat-lbl">${prop ? t('Prop Reduction') : t('Mode')}</div>
    </div>
  </div>`;

  // â”€â”€ Info boxes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let info = '';

  if (!allValid) {
    info += `<div class="infobox red animate-in">
      <div class="infobox-icon">âš ï¸</div>
      <div>
        <strong>${t('âš ï¸ Account too small:')}</strong> ${belowMin} ${t('strategies are below the minimum lot threshold.')}<br>
        ${prop
          ? `${t('Recommended minimum (Prop Firm:')} <strong>$15,000</strong>`
          : `${t('Recommended minimum:')} <strong>$5,000</strong>`}
      </div>
    </div>`;
  } else {
    info += `<div class="infobox green animate-in">
      <div class="infobox-icon">âœ…</div>
      <div>
        <strong>${t('âœ… Portfolio allocation valid')}</strong><br>
        ${prop
          ? `${t('Prop Firm Mode active')} â€” ${t('All strategies can run simultaneously within the 5% daily loss limit.')}`
          : t('All strategies operational. MC-calibrated lots protect against real 25â€“30% drawdown scenarios.')}
      </div>
    </div>`;
  }

  if (prop && balance < 15000) {
    info += `<div class="infobox orange animate-in-delay">
      <div class="infobox-icon">âš¡</div>
      <div>
        <strong>${t('âš¡ Prop Firm Warning:')}</strong> ${t('Running')} ${portfolio.length} ${t('strategies on a')} $${balance.toLocaleString()} ${t('account concentrates risk. Consider increasing balance, reducing active strategies, or switching to Conservative profile.')}
      </div>
    </div>`;
  }

  info += `<div class="infobox purple animate-in-delay">
    <div class="infobox-icon">ğŸ”¬</div>
    <div>
      <strong>${t('MC-calibrated')}</strong> â€” Lots recalculated with Monte Carlo factor (Ã—0.36) to reflect real 25â€“30% drawdown vs backtest 10% DD. Prop Firm Mode uses conservative risk profiles for additional safety.
    </div>
  </div>`;

  // â”€â”€ Table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const tableHtml = `
  <div class="table-card animate-in">
    <div class="table-header">
      <div class="table-title">${t('Allocation Table')}</div>
      <div class="table-meta">${t('MC-calibrated')} Â· ${portfolio.length} strategies</div>
    </div>
    <table>
      <tr>
        <th style="text-align:left">${t('Strategy')}</th>
        <th>${t('Lot Size')}</th>
        <th>${t('Status')}</th>
      </tr>
      ${rows}
    </table>
  </div>`;

  document.getElementById('results').innerHTML = statsHtml + info + tableHtml;
}

// â”€â”€â”€ LANGUAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function applyLang(l) {
  lang = l;
  localStorage.setItem('gtalgo-lang', l);

  document.querySelectorAll('.translatable').forEach(el => {
    const orig = origTexts.get(el);
    if (orig && T[l][orig]) el.textContent = T[l][orig];
  });

  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.classList.toggle('active', btn.getAttribute('data-lang') === l);
  });

  updateRiskProfiles();
}

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.translatable').forEach(el => {
    origTexts.set(el, el.textContent.trim());
  });

  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.addEventListener('click', () => applyLang(btn.getAttribute('data-lang')));
  });

  applyLang(lang);
  updateRiskProfiles();
  updateLabel();

  // Auto-calc on load for instant preview
  calc();
});
</script>
</body>
</html>
